<!-- // File: viewport-overlay.js
// File --help: viewprot-overlay_readme.md
// Title: Viewport Overlay Utility Documentation
// Version: rev.1.01
// Author: ElvenRivendil + Днева (ИИ-ассистент)
// Date: 2025-08-26
// Description: Подробная документация для утилиты viewport-overlay.js, 
// включая установку, использование и особенности работы в Chrome. -->

# viewport-overlay — журнал изменений

## Редакция .rev.1.01

### Содержание исправления
Добавлена фильтрация активных медиазапросов в логике скрипта `viewport-overlay.js`.  
Теперь при выводе в overlay отображается только **один медиазапрос на каждый CSS-файл**:  
- для условий с `max-width` выбирается наименьшее совпавшее значение;  
- для условий с `min-width` выбирается наибольшее совпавшее значение.  

Таким образом, overlay показывает наиболее «жёсткие» и приоритетные условия для каждого файла.

---

### Технические подробности — как реализовано
1. Перебор всех `document.styleSheets` и их `cssRules`.  
   - Для каждого файла (определяется по `sheet.href`, либо помечается как `inline <style>`) создаётся объект хранения совпадений.  

2. Проверка типа правила:  
   - Если `rule instanceof CSSMediaRule`, то берём `rule.conditionText` и проверяем его через `window.matchMedia()`.  

3. Парсинг условий:  
   - Регулярные выражения извлекают числовые значения из `max-width` и `min-width`.  
   - Для `max-width` хранится минимальное найденное значение.  
   - Для `min-width` хранится максимальное найденное значение.  

4. Формирование результата:  
   - Для каждого файла собирается итоговая строка:  
     - `(max-width: XXXpx)`  
     - `(min-width: YYYpx)`  
     - или комбинация `(min-width: YYYpx) and (max-width: XXXpx)`  
   - Строки дополняются указанием имени файла CSS.  

5. Возвращаемый результат формируется как список строк или сообщение «Нет активных @media».  

---

### Пример результата

- `(max-width: 480px) — mobile.css`  
- `(min-width: 1024px) — layout.css`  
- `(min-width: 768px) and (max-width: 1200px) — theme.css`